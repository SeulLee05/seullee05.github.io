---
layout: post
title: Molecule Generation with Fragment Retrieval Augmentation
---

<p style="text-align:center">
    Seul Lee<sup>1*</sup>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    Karsten Kreis<sup>2</sup>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    Srimukh Prasad Veccham<sup>2</sup>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    Meng Liu<sup>2</sup><br>
    Danny Reidenbach<sup>2</sup>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    Saee Paliwal<sup>2</sup>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    Arash Vahdat<sup>2†</sup>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    Weili Nie<sup>2†</sup><br>
    <span style="color:gray">
        1 <img height="25px" alt="KAIST" src="/assets/2024-09-17-f-rag/kaist.svg"/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        2 <img height="20px" alt="NVIDIA" src="/assets/2024-09-17-f-rag/nvidia.svg"/><br>
        * Work done during an internship at NVIDIA&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        † Equal advising<br>
        seul.lee@kaist.ac.kr<br>
        {kkreis, sveccham, menliu, dreidenbach, saeep, avahdat, wnie}@nvidia.com
    </span>
    <!-- <a href="https://arxiv.org" style="color:teal">[Paper]</a> -->
</p>

<br>

### Abstract
***
Fragment-based drug discovery, in which molecular fragments are assembled into new molecules with desirable biochemical properties, has achieved great success. However, many fragment-based molecule generation methods show limited exploration beyond the existing fragments in the database as they only reassemble or slightly modify the given ones. To tackle this problem, we propose a new fragment-based molecule generation framework with retrieval augmentation, namely *Fragment Retrieval-Augmented Generation* (*f*-RAG). *f*-RAG is based on a pre-trained molecular generative model that proposes additional fragments from input fragments to complete and generate a new molecule. Given a fragment vocabulary, *f*-RAG retrieves two types of fragments: (1) *hard fragments*, which serve as building blocks that will be explicitly included in the newly generated molecule, and (2) *soft fragments*, which serve as reference to guide the generation of new fragments through a trainable *fragment injection module*. To extrapolate beyond the existing fragments, *f*-RAG updates the fragment vocabulary with generated fragments via an iterative refinement process which is further enhanced with post-hoc genetic fragment modification. *f*-RAG can achieve an improved exploration-exploitation trade-off by maintaining a pool of fragments and expanding it with novel and high-quality fragments through a strong generative prior.

<br>

### Fragment-based molecule optimization with *f*-RAG
***
<p align="center"><img width="800px" alt="KAIST" src="/assets/2024-09-17-f-rag/f-rag.png"/></p>

After an initial fragment vocabulary is constructed from an existing molecule library, two types of fragments are retrieved during generation. Hard fragments are explicitly included in the newly generated molecules, while soft fragments implicitly guide the generation of new fragments. SAFE-GPT generates a molecule using hard fragments as input, while the fragment injection module in the middle of the SAFE-GPT layers injects the embeddings of soft fragments into the input embedding. After the generation, the molecule population and fragment vocabulary are updated with the newly generated molecule and its fragments, respectively. The exploration is further enhanced with genetic fragment modification, which also updates the fragment vocabulary and molecule population.

<br>

### Balanced Drug Discovery
***
d

<!-- ### Citation
***
```
@article{lee2024frag,
    title   = {Molecule Generation with Fragment Retrieval Augmentation},
    author  = {Seul Lee and Karsten Kreis},
    journal = {arXiv preprint arXiv:2302.05872},
    year    = {2024}
}
``` -->
